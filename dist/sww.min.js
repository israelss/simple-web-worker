(function(){var l="__CLOSE_WORKER__",A="This browser does not have URL.createObjectURL method.",h="This browser does not support Workers.",w=function(r,e,t){return"You should provide ".concat(r,"\n").concat(t,"\nReceived: ").concat(JSON.stringify(e))},R=function(r,e,t){return"You should provide ".concat(r,"\n").concat(t,"\nReceived a circular structure: ").concat(e)};var s=function(r){var e=r.expected,t=e===void 0?"":e,a=r.received,u=r.extraInfo,o=u===void 0?"":u;try{return new TypeError(w(t,a,o))}catch(c){if(c.message.includes("Converting circular structure to JSON"))return new TypeError(R(t,a,o));throw c}},b=function(r){return"\n  self.onmessage = function(event) {\n    const args = event.data.message.args\n    if (args) {\n      self.postMessage((".concat(r,").apply(null, args))\n      return close()\n    }\n    self.postMessage((").concat(r,")())\n    return close()\n  }\n")},O=function(r){return"\nself.onmessage = async function(event) {\n  if(event.data.message === '".concat(l,"'){\n    return close()\n  }\n\n  const args = event.data.message.args\n\n  if (args) {\n    const msg = await (").concat(r,").apply(null, args)\n    self.postMessage(msg)\n  }\n  const msg = await (").concat(r,")()\n  self.postMessage(msg)\n}\n")};function d(n){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},d(n)}var y=function(r){return function(e){return!!e&&!Array.isArray(e)&&r.every(function(t){return Object.getOwnPropertyNames(e).includes(t)})}},W=function(r){return y(["message","func"])(r)&&typeof r.func=="function"&&typeof r.message=="string"},T=function(r){return r.every(W)},I=function(r){return y(["message","args"])(r)&&Array.isArray(r.args)&&typeof r.message=="string"},C=function(r){return r.every(I)},M=function(r){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return r.every(y(e))}},x={actionsArray:function(r){return T(r)},arraysArray:function(r){return r.every(function(e){return Array.isArray(e)})},objectsArray:function(r){return M(r)()},postParamsArray:function(r){return C(r)},stringsArray:function(r){return r.every(function(e){return typeof e=="string"})}},E=function(r){return function(e){return e==="null"?r===null:e==="undefined"?r===void 0:e==="action"?W(r):Array.isArray(r)?e!=="array"&&!x[e]?!1:e==="array"?!0:x[e](r):r?d(r)===e.toString():!1}},i=function(r){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return Array.isArray(e)?e.some(function(t){return E(r)(t)}):!!E(r)(e)}};var S=function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=window.URL||window.webkitURL,a=new Blob([r],{type:"application/javascript"}),u=t.createObjectURL(a),o=new Worker(u);return o.post=function(c){return new Promise(function(g,p){o.onmessage=function(f){t.revokeObjectURL(u),g(e?{data:f.data,close:function(){return o.postMessage({message:l})}}:{data:f.data})},o.onerror=function(f){console.error("Error: Line ".concat(f.lineno," in ").concat(f.filename,": ").concat(f.message)),p(f)},o.postMessage({message:c})})},o};var m=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=i(r)("function"),u=i(e)(["array","undefined"]);if(a&&u){var o=t?O(r):b(r),c=S(o,t);return c.post({args:e})}return a||console.error(s({expected:"a function",received:r})),u||console.error(s({expected:"an array",received:e})),null};var j=function(r){var e="".concat(r," is not a registered action for this worker");return console.warn("WARN! ".concat(e)),e},V=function(r,e){return function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,a=arguments.length>1?arguments[1]:void 0,u=i(t)("string"),o=i(a)(["array","undefined"]);if(u&&o){var c=r.filter(function(g){var p=g.message;return JSON.stringify(p)===JSON.stringify(t)}).map(function(g){return g.func}).pop();return c?a?m(c,a,e):m(c,void 0,e):m(j,[JSON.stringify(t)])}return u||console.error(s({expected:"a string",received:t})),o||console.error(s({expected:"an array",received:a})),null}};function v(n){return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},v(n)}function _(){var n=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];if(i(r)(["arraysArray","postParamsArray","stringsArray"])){if(r.length===0)return Promise.all(this.actions.map(function(e){var t=e.message;return n.postMessage(t)}));if(r.every(function(e){return typeof e=="string"}))return Promise.all(r.map(function(e){return n.postMessage(e)}));if(r.every(function(e){return v(e)==="object"&&!Array.isArray(e)}))return Promise.all(r.map(function(e){var t=e.message,a=e.args;return n.postMessage(t,a)}));if(r.every(function(e){return Array.isArray(e)})&&r.length===this.actions.length)return Promise.all(r.map(function(e,t){return n.postMessage(n.actions[t].message,e)}))}return console.error(s({expected:"an array of arrays, an array of objects, or an array of strings",received:r,extraInfo:"If an array of arrays, it must have the same length as the actions registered for this worker.\nIf an array of objects, every object must containing two fields:\n* message\n* args"})),null}var D=function(r){return function(e){return r.some(function(t){return t.message===e.message})}},k=function(r){return function(e){return D(r)(e)?(console.warn('WARN! An action with message "'.concat(e.message,'" is already registered for this worker')),r.length):r.push(e)}},P=function(r){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return i(e)(["action","actionsArray"])?Array.isArray(e)?e.reduce(function(t,a){return k(t)(a),t},r).length:k(r)(e):(console.error(s({expected:"an array of actions or an action",received:e,extraInfo:"Every action should be an object containing two fields:\n* message\n* func"})),null)}};var L=function(r){return function(e){var t=r.findIndex(function(a){var u=a.message;return u===e});return t===-1?console.warn('WARN! Impossible to unregister action with message "'.concat(e,'".\nIt was not found as a registered action for this worker.')):r.splice(t,1),r}},U=function(r){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return i(e)(["string","stringsArray"])?Array.isArray(e)?e.reduce(function(t,a){return L(t)(a),t},r).length:L(r)(e).length:(console.error(s({expected:"an array of strings or a string",received:e})),null)}};var N=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return i(r)("actionsArray")?{actions:r,postMessage:V(r,e),postAll:_,register:P(r),unregister:U(r)}:(console.error(s({expected:"an array of objects",received:r,extraInfo:"Every action should be an object containing two fields:\n* message\n* func"})),null)};var J=function(){return window.Worker?window.URL.createObjectURL||window.webkitURL.createObjectURL?{create:N,run:m}:(console.error(A),null):(console.error(h),null)},F=J(),Or=F;})();
